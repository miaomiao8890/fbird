<h1 class="title">正在匹配 <%= roomId %> <%= nickname %></h1>
<div id="dancefloor"></div>

<script>
	$(function() {
		var socket = io.connect('<%= HOST %>'),
			roomId = '<%= roomId %>',
			nickname = '<%= nickname %>',competitor,
			players = '<%= players %>'.split(',');
		//console.log(players);

		//告诉服务器端已登陆
		socket.emit('login', { roomid: roomId, username: nickname });

		if (players.length == 2) {
			//告诉服务器游戏开始
			socket.emit('match', { roomid: roomId, players: players });
		}

		socket.on('match', function(message) {
			console.log(message);
			//游戏初始化
			gameInit(message);
		});

		socket.on('message', function(message) {
			console.log(message.data);
			switch(message.data.type) {
				case 'move':
					console.log('跳跃');
					break;
				default:
					console.log('场景');
			}
		});

		function gameInit(players) {
			$('h1').text('游戏开始');
			competitor = players[0] != nickname ? players[0] : players[1];
			addUser(nickname);
			addUser(competitor);
		}

		function addUser(player) {
			$('#dancefloor').append("<div class='dancer'><div class='nickname'>" + player + "</div><div class='user hi' id='" + player + "'></div></div>");
		}
	});
</script>